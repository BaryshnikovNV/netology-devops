# Домашнее задание к занятию "`Введение в Terraform`" - `Барышников Никита`


## Задание 1.
<details>
	<summary></summary>
      <br>

1. Перейдите в каталог [**src**](https://github.com/netology-code/ter-homeworks/tree/main/01/src). Скачайте все необходимые зависимости, использованные в проекте. 
2. Изучите файл **.gitignore**. В каком terraform-файле, согласно этому .gitignore, допустимо сохранить личную, секретную информацию?
3. Выполните код проекта. Найдите  в state-файле секретное содержимое созданного ресурса **random_password**, пришлите в качестве ответа конкретный ключ и его значение.
4. Раскомментируйте блок кода, примерно расположенный на строчках 29–42 файла **main.tf**.
Выполните команду ```terraform validate```. Объясните, в чём заключаются намеренно допущенные ошибки. Исправьте их.
5. Выполните код. В качестве ответа приложите: исправленный фрагмент кода и вывод команды ```docker ps```.
6. Замените имя docker-контейнера в блоке кода на ```hello_world```. Не перепутайте имя контейнера и имя образа. Мы всё ещё продолжаем использовать name = "nginx:latest". Выполните команду ```terraform apply -auto-approve```.
Объясните своими словами, в чём может быть опасность применения ключа  ```-auto-approve```. Догадайтесь или нагуглите зачем может пригодиться данный ключ? В качестве ответа дополнительно приложите вывод команды ```docker ps```.
8. Уничтожьте созданные ресурсы с помощью **terraform**. Убедитесь, что все ресурсы удалены. Приложите содержимое файла **terraform.tfstate**. 
9. Объясните, почему при этом не был удалён docker-образ **nginx:latest**. Ответ **обязательно** подкрепите строчкой из документации [**terraform провайдера docker**](https://docs.comcloud.xyz/providers/kreuzwerker/docker/latest/docs).  (ищите в классификаторе resource docker_image)

</details>

### Решение:

Скриншот 1 - Скриншот вывода команды ```terraform --version```.
![Скриншот-1](/TER-35/ter/17.1-ter-01/img/17.1_Скриншот_вывода_команды_terraform_--version.png)

1.2. Согласно **.gitignore**, допустимо сохранить личную, секретную информацию в файле **personal.auto.tfvars**.  
**terraform.tfvars** — автоматически загружаемый файл, в котором можно задавать значения переменных. Так как, файл personal.auto.tfvars находится в .gitignore, то можно не опасаться утечки данных.

1.3.  
Скриншот 2 - Выполнение кода проекта.
![Скриншот-2](/TER-35/ter/17.1-ter-01/img/17.1.1.3.1_Выполнение_кода_проекта.png)

Скриншот 3 - Секретное содержимое созданного ресурса random_password в state-файле.
![Скриншот-3](/TER-35/ter/17.1-ter-01/img/17.1.1.3.2_Секретное_содержимое_созданного_ресурса_random_password_в_state-файле.png)

Секретное содержимое созданного ресурса random_password в state-файле: ```random_string="xHT6myJ1n1TygLEi"```

1.4.  
Скриншот 4 - Выполнение команды terraform validate.
![Скриншот-4](/TER-35/ter/17.1-ter-01/img/17.1.1.4.1_Выполнение_команды_terraform_validate.png)

Ошибка *Missing name for resource* говорит о том, что отсутствует имя для ресурса. Все блоки ресурсов должны иметь 2 метки (тип, название), поэтому для исправления ошибки необходимо добавить к описанию ресурса ```docker_image``` имя ```nginx```, тогда строка 23 будет выглядить следующим образом:  
```HCL
resource "docker_image" "nginx" {
```

Ошибка *Error: Invalid resource name* говорит о неверном имени ресурса. Имя должно начинаться с буквы или символа подчеркивания и может содержать только буквы, цифры, знаки подчеркивания и тире. Следовательно, для исправления ошибки необходимо убрать из начала имени ```1nginx``` цифру 1 и переастативить, например, в конец, тогда строка 28 будет выглядить следующим образом:  
```HCL
resource "docker_container" "nginx-1" {
```

Ошибка *Reference to undeclared resource* говорит о том, что русурс ```random_string_FAKE``` не был определен. Правильное имя ресурса будет ```random_string```. Также, необходимо изменить прописную букву ```T``` на строчную ```t``` в ```resulT```. Следовательно, строка 30 будет выглядить следующим образом:  
```HCL
name  = "example_${random_password.random_string.result}"
```

1.5.  
Скриншот 5 - Вывод команды ```docker ps```.
![Скриншот-5](/TER-35/ter/17.1-ter-01/img/17.1.1.5_Вывод_команды_docker_ps.png)

1.6.
Заменим имя docker-контейнера в блоке кода на ```hello_world```:  
```HCL
resource "docker_container" "nginx-1" {
  image = docker_image.nginx.image_id
  name  = "hello world"

  ports {
    internal = 80
    external = 8000
  }
}
```

Выполним команду ```terraform apply -auto-approve```.  
Ключ ```-auto-approve``` пропускает интерактивное утверждение плана перед подачей заявки.  
Это делает использование ```-auto-approve``` очень опасным, поскольку некоторые ошибки могут привести к необратимой потере данных или уничтожению базы данных. Эти ошибки будут применены без запроса одобрения.

Скриншот 6 - Вывод команды ```docker ps```.
![Скриншот-6](/TER-35/ter/17.1-ter-01/img/17.1.1.6_Вывод_команды_docker_ps.png)

1.7.  
Скриншот 7 - Cодержимое файла terraform.tfstate после уничтожения созданных ресурсов с помощью terraform.
![Скриншот-7](/TER-35/ter/17.1-ter-01/img/17.1.1.7_Cодержимое_файла_terraform.tfstate.png)

1.8.  
При уничтожении созданных ресурсов с помощью terraform, docker-образ nginx:latest не был удален, потому что опция ```keep_locally``` имела значение **true**.

Cтрочка из документации [**terraform провайдера docker**](https://docs.comcloud.xyz/providers/kreuzwerker/docker/latest/docs):
```keep_locally``` (Boolean) If true, then the Docker image won't be deleted on destroy operation. If this is false, it will delete the image from the docker local storage on destroy operation.

---